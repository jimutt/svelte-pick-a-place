var PickAPlace=function(){"use strict";function t(){}function e(t,e){for(const n in e)t[n]=e[n];return t}function n(t){return t()}function o(){return Object.create(null)}function l(t){t.forEach(n)}function c(t){return"function"==typeof t}function a(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function i(t,n,o){return t[1]?e({},e(n.$$scope.ctx,t[1](o?o(n):{}))):n.$$scope.ctx}function r(t,e){t.appendChild(e)}function s(t,e,n){t.insertBefore(e,n||null)}function d(t){t.parentNode.removeChild(t)}function u(t){return document.createElement(t)}function p(t){return document.createTextNode(t)}function g(){return p(" ")}function f(){return p("")}function m(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function $(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function h(t,e){e=""+e,t.data!==e&&(t.data=e)}function v(t,e,n){t.classList[n?"add":"remove"](e)}let y;function b(t){y=t}function _(){if(!y)throw new Error("Function called outside component initialization");return y}function k(t){_().$$.on_destroy.push(t)}function x(){const t=y;return(e,n)=>{const o=t.$$.callbacks[e];if(o){const l=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);o.slice().forEach(e=>{e.call(t,l)})}}}function M(t){return _().$$.context.get(t)}function w(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(t=>t(e))}const C=[],O=Promise.resolve();let N=!1;const E=[],P=[],S=[];function T(){N||(N=!0,O.then(I))}function z(t){E.push(t)}function F(t){P.push(t)}function I(){const t=new Set;do{for(;C.length;){const t=C.shift();b(t),A(t.$$)}for(;E.length;)E.shift()();for(;P.length;){const e=P.pop();t.has(e)||(e(),t.add(e))}}while(C.length);for(;S.length;)S.pop()();N=!1}function A(t){t.fragment&&(t.update(t.dirty),l(t.before_render),t.fragment.p(t.dirty,t.ctx),t.dirty=null,t.after_render.forEach(F))}let j;function B(){j={remaining:0,callbacks:[]}}function q(){j.remaining||l(j.callbacks)}function R(t){j.callbacks.push(t)}function U(t,e,o){const{fragment:a,on_mount:i,on_destroy:r,after_render:s}=t.$$;a.m(e,o),F(()=>{const e=i.map(n).filter(c);r?r.push(...e):l(e),t.$$.on_mount=[]}),s.forEach(F)}function V(e,n,c,a,i,r){const s=y;b(e);const d=n.props||{},u=e.$$={fragment:null,ctx:null,props:r,update:t,not_equal:i,bound:o(),on_mount:[],on_destroy:[],before_render:[],after_render:[],context:new Map(s?s.$$.context:[]),callbacks:o(),dirty:null};let p=!1;u.ctx=c?c(e,d,(t,n)=>{u.ctx&&i(u.ctx[t],u.ctx[t]=n)&&(u.bound[t]&&u.bound[t](n),p&&function(t,e){t.$$.dirty||(C.push(t),T(),t.$$.dirty=o()),t.$$.dirty[e]=!0}(e,t))}):d,u.update(),p=!0,l(u.before_render),u.fragment=a(u.ctx),n.target&&(n.hydrate?u.fragment.l(function(t){return Array.from(t.childNodes)}(n.target)):u.fragment.c(),n.intro&&e.$$.fragment.i&&e.$$.fragment.i(),U(e,n.target,n.anchor),I()),b(s)}class Y{$destroy(){var e,n;n=!0,(e=this).$$&&(l(e.$$.on_destroy),e.$$.fragment.d(n),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={}),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}const Z={};function D(e){var n,o,c,a,i,p,f,h;return{c(){n=u("div"),o=u("div"),(c=u("h4")).textContent="Mode",a=g(),(i=u("button")).textContent="Point",p=g(),(f=u("button")).textContent="Polygon",i.dataset.testid="point-mode-btn",i.className="pick-a-place__drawing-button",v(i,"active","point"===e.mode),f.dataset.testid="polygon-mode-btn",f.className="pick-a-place__drawing-button",v(f,"active","polygon"===e.mode),o.className="pick-a-place__drawing-toolbar",n.className="pick-a-place__drawing-toolbar-wrapper",h=[m(i,"click",$(e.click_handler)),m(f,"click",$(e.click_handler_1))]},m(t,e){s(t,n,e),r(n,o),r(o,c),r(o,a),r(o,i),r(o,p),r(o,f)},p(t,e){t.mode&&(v(i,"active","point"===e.mode),v(f,"active","polygon"===e.mode))},i:t,o:t,d(t){t&&d(n),l(h)}}}function G(t,e,n){const o=x(),{getMap:l,getLeaflet:c}=M(Z);let{mode:a="point"}=e;const i=t=>{n("mode",a=t),o("setMode",a)};return t.$set=t=>{"mode"in t&&n("mode",a=t.mode)},{mode:a,setMode:i,click_handler:function(){return i("point")},click_handler_1:function(){return i("polygon")}}}class H extends Y{constructor(t){super(),V(this,t,G,D,a,["mode"])}}function J(e){return{c:t,m:t,p:t,i:t,o:t,d:t}}function K(t,e,n){const{getMap:o,getLeaflet:l}=M(Z),c=x();let a,{lat:i,lng:r,clickable:s=!1}=e,d=o(),u=l();const p=()=>{s&&c("click")};return k(()=>{a&&d.removeLayer(a)}),t.$set=t=>{"lat"in t&&n("lat",i=t.lat),"lng"in t&&n("lng",r=t.lng),"clickable"in t&&n("clickable",s=t.clickable)},t.$$.update=(t={lat:1,lng:1,marker:1,leaflet:1,map:1})=>{(t.lat||t.lng||t.marker||t.leaflet||t.map)&&(i&&r?a?a.setLatLng([i,r]):(n("marker",a=u.marker([i,r]).addTo(d)),a.on("click",p)):a&&d.removeLayer(a))},{lat:i,lng:r,clickable:s}}class Q extends Y{constructor(t){super(),V(this,t,K,J,a,["lat","lng","clickable"])}}function W(t){var e,n=new Q({props:{lat:t.lat,lng:t.lng}});return{c(){n.$$.fragment.c()},m(t,o){U(n,t,o),e=!0},p(t,e){var o={};t.lat&&(o.lat=e.lat),t.lng&&(o.lng=e.lng),n.$set(o)},i(t){e||(n.$$.fragment.i(t),e=!0)},o(t){n.$$.fragment.o(t),e=!1},d(t){n.$destroy(t)}}}function X(t){var e,n,o=t.lat&&t.lng&&W(t);return{c(){o&&o.c(),e=f()},m(t,l){o&&o.m(t,l),s(t,e,l),n=!0},p(t,n){n.lat&&n.lng?o?(o.p(t,n),o.i(1)):((o=W(n)).c(),o.i(1),o.m(e.parentNode,e)):o&&(B(),R(()=>{o.d(1),o=null}),o.o(1),q())},i(t){n||(o&&o.i(),n=!0)},o(t){o&&o.o(),n=!1},d(t){o&&o.d(t),t&&d(e)}}}function tt(t,e,n){let o,l;const c=x(),{getMap:a}=M(Z);let i=a();const r=t=>{n("lat",o=t.latlng.lat),n("lng",l=t.latlng.lng),c("update",t.latlng)};return i.on("click",r),k(()=>i.off("click",r)),{lat:o,lng:l}}class et extends Y{constructor(t){super(),V(this,t,tt,X,a,[])}}function nt(t,e){return t.lat===e.lat&&t.lng===e.lng}function ot(t){var e,n=new Q({props:{lat:t.coordinates[0].lat,lng:t.coordinates[0].lng,clickable:t.allowClosingPolygon}});return n.$on("click",t.closePolygon),{c(){n.$$.fragment.c()},m(t,o){U(n,t,o),e=!0},p(t,e){var o={};t.coordinates&&(o.lat=e.coordinates[0].lat),t.coordinates&&(o.lng=e.coordinates[0].lng),t.allowClosingPolygon&&(o.clickable=e.allowClosingPolygon),n.$set(o)},i(t){e||(n.$$.fragment.i(t),e=!0)},o(t){n.$$.fragment.o(t),e=!1},d(t){n.$destroy(t)}}}function lt(t){var e,n,o=t.coordinates.length>0&&t.polyline.getLatLngs().length>0&&ot(t);return{c(){o&&o.c(),e=f()},m(t,l){o&&o.m(t,l),s(t,e,l),n=!0},p(t,n){n.coordinates.length>0&&n.polyline.getLatLngs().length>0?o?(o.p(t,n),o.i(1)):((o=ot(n)).c(),o.i(1),o.m(e.parentNode,e)):o&&(B(),R(()=>{o.d(1),o=null}),o.o(1),q())},i(t){n||(o&&o.i(),n=!0)},o(t){o&&o.o(),n=!1},d(t){o&&o.d(t),t&&d(e)}}}function ct(t,e,n){const o=x(),{getMap:l}=M(Z);let{coordinates:c=[]}=e;const a=l();let i=L.polyline([],{color:"red"}).addTo(a),r=L.polygon([],{color:"red"}).addTo(a);let s;return k(()=>{a.removeLayer(i),a.removeLayer(r)}),t.$set=t=>{"coordinates"in t&&n("coordinates",c=t.coordinates)},t.$$.update=(t={coordinates:1,polygon:1,polyline:1})=>{if((t.coordinates||t.polygon||t.polyline)&&c.length>0){const t=c[0],e=c[c.length-1];c.length>1&&nt(t,e)?(r.setLatLngs([c]),i.setLatLngs([])):(i.setLatLngs(c),r.setLatLngs([]))}t.coordinates&&n("allowClosingPolygon",s=c.length>2&&!nt(c[0],c[c.length-1]))},{coordinates:c,polyline:i,closePolygon:()=>{n("coordinates",c=[...c,c[0]]),o("complete",c)},allowClosingPolygon:s}}class at extends Y{constructor(t){super(),V(this,t,ct,lt,a,["coordinates"])}}function it(t){var e,n;function o(n){var o;t.leafletpolygon_coordinates_binding.call(null,n),e=!0,o=()=>e=!1,S.push(o)}let l={};void 0!==t.coordinates&&(l.coordinates=t.coordinates);var c=new at({props:l});return z(()=>(function(t,e,n){-1!==t.$$.props.indexOf(e)&&(t.$$.bound[e]=n,n(t.$$.ctx[e]))})(c,"coordinates",o)),c.$on("update",t.update_handler),c.$on("complete",t.complete_handler),{c(){c.$$.fragment.c()},m(t,e){U(c,t,e),n=!0},p(t,n){var o={};!e&&t.coordinates&&(o.coordinates=n.coordinates),c.$set(o)},i(t){n||(c.$$.fragment.i(t),n=!0)},o(t){c.$$.fragment.o(t),n=!1},d(t){c.$destroy(t)}}}function rt(t,e,n){const o=x(),{getMap:l}=M(Z);let c=[],a=l();const i=t=>{c.length>2&&nt(c[0],c[c.length-1])||(n("coordinates",c=[...c,t.latlng]),o("update",c))};return a.on("click",i),k(()=>a.off("click",i)),{dispatch:o,coordinates:c,leafletpolygon_coordinates_binding:function(t){n("coordinates",c=t)},update_handler:function({detail:t}){return o("update",t)},complete_handler:function({detail:t}){return o("complete",t)}}}class st extends Y{constructor(t){super(),V(this,t,rt,it,a,[])}}function dt(t){var e,n=new st({});return n.$on("update",t.update_handler_1),n.$on("complete",t.complete_handler),{c(){n.$$.fragment.c()},m(t,o){U(n,t,o),e=!0},i(t){e||(n.$$.fragment.i(t),e=!0)},o(t){n.$$.fragment.o(t),e=!1},d(t){n.$destroy(t)}}}function ut(t){var e,n=new et({});return n.$on("update",t.update_handler),{c(){n.$$.fragment.c()},m(t,o){U(n,t,o),e=!0},i(t){e||(n.$$.fragment.i(t),e=!0)},o(t){n.$$.fragment.o(t),e=!1},d(t){n.$destroy(t)}}}function pt(t){var e;function n(t){return"point"===t.selectionMode?ft:"polygon"===t.selectionMode?gt:void 0}var o=n(t),l=o&&o(t);return{c(){e=u("div"),l&&l.c(),e.className="pick-a-place__guide-panel",e.dataset.testid="guide-overlay"},m(t,n){s(t,e,n),l&&l.m(e,null)},p(t,c){o===(o=n(c))&&l?l.p(t,c):(l&&l.d(1),(l=o&&o(c))&&(l.c(),l.m(e,null)))},d(t){t&&d(e),l&&l.d()}}}function gt(t){var e,n;return{c(){e=u("span"),n=p(t.polygonInstructionText)},m(t,o){s(t,e,o),r(e,n)},p(t,e){t.polygonInstructionText&&h(n,e.polygonInstructionText)},d(t){t&&d(e)}}}function ft(t){var e;function n(t){return null!=t.position&&null!=t.position.lat?$t:mt}var o=n(t),l=o(t);return{c(){l.c(),e=f()},m(t,n){l.m(t,n),s(t,e,n)},p(t,c){o===(o=n(c))&&l?l.p(t,c):(l.d(1),(l=o(c))&&(l.c(),l.m(e.parentNode,e)))},d(t){l.d(t),t&&d(e)}}}function mt(e){var n;return{c(){(n=u("span")).textContent="Click the map to select a position"},m(t,e){s(t,n,e)},p:t,d(t){t&&d(n)}}}function $t(t){var e,n,o,l,c,a=t.position.lat.toFixed(5),i=t.position.lng.toFixed(5);return{c(){e=u("span"),n=p("Latitude: "),o=p(a),l=p(" Longitude: "),c=p(i)},m(t,a){s(t,e,a),r(e,n),r(e,o),r(e,l),r(e,c)},p(t,e){t.position&&a!==(a=e.position.lat.toFixed(5))&&h(o,a),t.position&&i!==(i=e.position.lng.toFixed(5))&&h(c,i)},d(t){t&&d(e)}}}function ht(t){var e,n,o,c,a,i,f,h,v="polygon"===t.selectionMode&&t.selectionComplete&&vt(t);return{c(){e=u("div"),(n=u("button")).textContent="Cancel",o=g(),v&&v.c(),c=g(),a=u("button"),i=p("Use selection"),n.type="button",a.type="button",a.disabled=f=!t.selectionComplete,e.className="pick-a-place__button-panel",e.dataset.testid="button-overlay",h=[m(n,"click",$(t.click_handler)),m(a,"click",$(t.click_handler_1))]},m(t,l){s(t,e,l),r(e,n),r(e,o),v&&v.m(e,null),r(e,c),r(e,a),r(a,i)},p(t,n){"polygon"===n.selectionMode&&n.selectionComplete?v?v.p(t,n):((v=vt(n)).c(),v.m(e,c)):v&&(v.d(1),v=null),t.selectionComplete&&f!==(f=!n.selectionComplete)&&(a.disabled=f)},d(t){t&&d(e),v&&v.d(),l(h)}}}function vt(e){var n,o;return{c(){(n=u("button")).textContent="Reset selection",n.type="button",o=m(n,"click",$(e.resetSelection))},m(t,e){s(t,n,e)},p:t,d(t){t&&d(n),o()}}}function yt(t){var e,n,o,l,c,a,i,r=new H({props:{":mode":t.selectionMode}});r.$on("setMode",t.handleSetMode);var u=[ut,dt],p=[];function m(t){return"point"===t.selectionMode?0:"polygon"===t.selectionMode?1:-1}~(n=m(t))&&(o=p[n]=u[n](t));var $=t.guideOverlay&&pt(t),h=t.buttons&&ht(t);return{c(){r.$$.fragment.c(),e=g(),o&&o.c(),l=g(),$&&$.c(),c=g(),h&&h.c(),a=f()},m(t,o){U(r,t,o),s(t,e,o),~n&&p[n].m(t,o),s(t,l,o),$&&$.m(t,o),s(t,c,o),h&&h.m(t,o),s(t,a,o),i=!0},p(t,e){var i={};t.selectionMode&&(i[":mode"]=e.selectionMode),r.$set(i);var s=n;(n=m(e))!==s&&(o&&(B(),R(()=>{p[s].d(1),p[s]=null}),o.o(1),q()),~n?((o=p[n])||(o=p[n]=u[n](e)).c(),o.i(1),o.m(l.parentNode,l)):o=null),e.guideOverlay?$?$.p(t,e):(($=pt(e)).c(),$.m(c.parentNode,c)):$&&($.d(1),$=null),e.buttons?h?h.p(t,e):((h=ht(e)).c(),h.m(a.parentNode,a)):h&&(h.d(1),h=null)},i(t){i||(r.$$.fragment.i(t),o&&o.i(),i=!0)},o(t){r.$$.fragment.o(t),o&&o.o(),i=!1},d(t){r.$destroy(t),t&&d(e),~n&&p[n].d(t),t&&d(l),$&&$.d(t),t&&d(c),h&&h.d(t),t&&d(a)}}}function bt(t,e,n){const o=x();let{placeMarker:l=!0,guideOverlay:c=!0,buttons:a=!0,selectionMode:i="point"}=e,r=null,s=!1;const d=(t,e=!1)=>{n("position",r=t),n("selectionComplete",s=e),o("update",r)},u=t=>{d(t,!0)};let p;return t.$set=t=>{"placeMarker"in t&&n("placeMarker",l=t.placeMarker),"guideOverlay"in t&&n("guideOverlay",c=t.guideOverlay),"buttons"in t&&n("buttons",a=t.buttons),"selectionMode"in t&&n("selectionMode",i=t.selectionMode)},t.$$.update=(t={position:1})=>{t.position&&n("polygonInstructionText",p=(t=>null!=t&&t.length?s?"Selection completed":t.length<=2?"Select the next point of the polygon":t.length>2?"Add additional points or click the start position to finish editing.":void 0:"Select polygon start position")(r))},{dispatch:o,placeMarker:l,guideOverlay:c,buttons:a,selectionMode:i,position:r,selectionComplete:s,setPosition:d,completePolygon:u,handleSetMode:({detail:t})=>{n("selectionComplete",s=!1),n("selectionMode",i=t)},resetSelection:async({detail:t})=>{n("selectionComplete",s=!1),n("position",r=null);const e=i;n("selectionMode",i=-1),await(T(),O),n("selectionMode",i=e)},polygonInstructionText:p,update_handler:function({detail:t}){return d(t,!0)},update_handler_1:function({detail:t}){return d(t)},complete_handler:function({detail:t}){return u(t)},click_handler:function(){return o("cancel")},click_handler_1:function(){return o("save",r)}}}class _t extends Y{constructor(t){super(),V(this,t,bt,yt,a,["placeMarker","guideOverlay","buttons","selectionMode"])}}function kt(t){var e,n=new _t({props:{guideOverlay:t.guideOverlay,buttons:t.buttons}});return n.$on("update",t.update_handler),n.$on("save",t.save_handler),n.$on("cancel",t.cancel_handler),{c(){n.$$.fragment.c()},m(t,o){U(n,t,o),e=!0},p(t,e){var o={};t.guideOverlay&&(o.guideOverlay=e.guideOverlay),t.buttons&&(o.buttons=e.buttons),n.$set(o)},i(t){e||(n.$$.fragment.i(t),e=!0)},o(t){n.$$.fragment.o(t),e=!1},d(t){n.$destroy(t)}}}function xt(t){var n,o,l,c,a;const p=t.$$slots.default,f=function(t,e,n){if(t){const o=i(t,e,n);return t[0](o)}}(p,t,null);var m=t.map&&kt(t);return{c(){n=u("div"),o=u("div"),l=u("div"),f&&f.c(),c=g(),m&&m.c(),l.className="pick-a-place__overlay-content",o.className="pick-a-place__overlay-container",n.className="pick-a-place svelte-idsbto"},l(t){f&&f.l(div0_nodes)},m(e,i){s(e,n,i),r(n,o),r(o,l),f&&f.m(l,null),r(l,c),m&&m.m(l,null),z(()=>t.div2_binding(n,null)),a=!0},p(t,o){f&&f.p&&t.$$scope&&f.p(function(t,n,o,l){return t[1]?e({},e(n.$$scope.changed||{},t[1](l?l(o):{}))):n.$$scope.changed||{}}(p,o,t,null),i(p,o,null)),o.map?m?(m.p(t,o),m.i(1)):((m=kt(o)).c(),m.i(1),m.m(l,null)):m&&(B(),R(()=>{m.d(1),m=null}),m.o(1),q()),t.items&&(o.div2_binding(null,n),o.div2_binding(n,null))},i(t){a||(f&&f.i&&f.i(t),m&&m.i(),a=!0)},o(t){f&&f.o&&f.o(t),m&&m.o(),a=!1},d(e){e&&d(n),f&&f.d(e),m&&m.d(),t.div2_binding(null,n)}}}function Mt(t,e,n){let{leaflet:o,lat:l=45,lng:c=0,zoom:a=3,guideOverlay:i=!0,buttons:r=!0}=e;var s,d;let u,p;var g;s=Z,d={getMap:()=>p,getLeaflet:()=>o},_().$$.context.set(s,d),g=()=>{if(null==o)throw new Error("No Leaflet instance was provided.");n("map",p=o.map(u).setView([l,c],a)),o.tileLayer("https://a.tile.openstreetmap.org/{z}/{x}/{y}.png ",{attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>',maxZoom:18}).addTo(p)},_().$$.on_mount.push(g);let{$$slots:f={},$$scope:m}=e;return t.$set=t=>{"leaflet"in t&&n("leaflet",o=t.leaflet),"lat"in t&&n("lat",l=t.lat),"lng"in t&&n("lng",c=t.lng),"zoom"in t&&n("zoom",a=t.zoom),"guideOverlay"in t&&n("guideOverlay",i=t.guideOverlay),"buttons"in t&&n("buttons",r=t.buttons),"$$scope"in t&&n("$$scope",m=t.$$scope)},{leaflet:o,lat:l,lng:c,zoom:a,guideOverlay:i,buttons:r,mapElement:u,map:p,update_handler:function(e){w(t,e)},save_handler:function(e){w(t,e)},cancel_handler:function(e){w(t,e)},div2_binding:function(t,e){n("mapElement",u=t)},$$slots:f,$$scope:m}}return class extends Y{constructor(t){super(),V(this,t,Mt,xt,a,["leaflet","lat","lng","zoom","guideOverlay","buttons"])}}}();
